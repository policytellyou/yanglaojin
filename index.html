<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>养老金领取地测算工具</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: "Microsoft YaHei", sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 24px;
        }
        
        .step {
            display: none;
        }
        
        .step.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        input, select {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 5px;
        }
        
        .radio-group label {
            display: flex;
            align-items: center;
            font-weight: normal;
            cursor: pointer;
        }
        
        .radio-group input {
            width: auto;
            margin-right: 5px;
        }
        
        .section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .section-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .insured-record {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border: 1px solid #eee;
        }
        
        .insured-record h3 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #3498db;
        }
        
        .row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .col {
            flex: 1;
            min-width: 150px;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            display: block;
            margin-top: 10px;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .btn-next {
            background-color: #2ecc71;
        }
        
        .btn-next:hover {
            background-color: #27ae60;
        }
        
        .btn-back {
            background-color: #95a5a6;
        }
        
        .btn-back:hover {
            background-color: #7f8c8d;
        }
        
        .btn-add {
            background-color: #2ecc71;
        }
        
        .btn-add:hover {
            background-color: #27ae60;
        }
        
        .btn-remove {
            background-color: #e74c3c;
            width: auto;
            margin-top: 0;
        }
        
        .btn-remove:hover {
            background-color: #c0392b;
        }
        
        .result {
            margin-top: 30px;
            padding: 20px;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        
        .result h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .result-item {
            margin-bottom: 15px;
            padding: 15px;
            background-color: #fff;
            border-radius: 4px;
            border-left: 4px solid #3498db;
        }
        
        .result-item strong {
            color: #2c3e50;
        }
        
        .result-item .highlight {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .result-item .section-title {
            font-size: 16px;
            margin-bottom: 10px;
            color: #2c3e50;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        
        .temp-account {
            border-left-color: #e74c3c;
        }
        
        .final-result {
            background-color: #e8f4fd;
            border-left-color: #3498db;
            font-weight: bold;
            margin-top: 15px;
        }
        
        .error {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        .years-months-input {
            display: flex;
            gap: 10px;
        }
        
        .years-months-input input {
            flex: 1;
        }
        
        .years-months-display {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        .guangdong-section {
            display: none;
        }
        
        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .info-table th, .info-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        
        .info-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        
        .info-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }
        
        .step-indicator::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: #ddd;
            z-index: 1;
        }
        
        .step-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        
        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #ddd;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .step-item.active .step-number {
            background-color: #3498db;
        }
        
        .step-item.completed .step-number {
            background-color: #2ecc71;
        }
        
        .step-label {
            font-size: 14px;
            color: #7f8c8d;
        }
        
        .step-item.active .step-label {
            color: #3498db;
            font-weight: bold;
        }
        
        .step-item.completed .step-label {
            color: #2ecc71;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal h2 {
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .early-result {
            background-color: #e8f4fd;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
            border-left: 4px solid #3498db;
        }
        
        .early-result h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .button-group button {
            flex: 1;
            margin-top: 0;
        }
        
        .policy-content {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 14px;
            line-height: 1.5;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .policy-section {
            margin-bottom: 20px;
        }
        
        .policy-section h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .location-result {
            font-size: 18px;
            font-weight: bold;
            color: #e74c3c;
            margin: 10px 0;
        }
        
        .satisfy-requirement {
            color: #2ecc71;
            font-weight: bold;
        }
        
        .not-satisfy-requirement {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .early-warning {
            color: #e74c3c;
            font-weight: bold;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #ffeaea;
            border-radius: 4px;
            border-left: 4px solid #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>养老金领取地测算工具</h1>
        
        <div class="step-indicator">
            <div class="step-item active" id="step1-indicator">
                <div class="step-number">1</div>
                <div class="step-label">基本信息</div>
            </div>
            <div class="step-item" id="step2-indicator">
                <div class="step-number">2</div>
                <div class="step-label">参保信息</div>
            </div>
            <div class="step-item" id="step3-indicator">
                <div class="step-number">3</div>
                <div class="step-label">测算结果</div>
            </div>
        </div>
        
        <!-- 第一步：基本信息采集 -->
        <div class="step active" id="step1">
            <form id="basicInfoForm">
                <div class="form-group">
                    <label for="birthDate">出生日期</label>
                    <input type="date" id="birthDate" name="birthDate" required>
                    <div class="error" id="birthDateError">请输入有效的出生日期</div>
                </div>
                
                <div class="form-group">
                    <label>性别</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="gender" value="male" required> 男
                        </label>
                        <label>
                            <input type="radio" name="gender" value="female"> 女
                        </label>
                    </div>
                </div>
                
                <div class="form-group" id="jobTypeGroup" style="display: none;">
                    <label>劳动合同签署的岗位性质</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="jobType" value="management"> 管理岗/技术岗/灵活就业人员
                        </label>
                        <label>
                            <input type="radio" name="jobType" value="non-management"> 非管理技术岗
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="hukouProvince">户籍所在地（省份）</label>
                    <select id="hukouProvince" name="hukouProvince" required>
                        <option value="">-- 请选择省份 --</option>
                        <option value="北京市">北京市</option>
                        <option value="天津市">天津市</option>
                        <option value="河北省">河北省</option>
                        <option value="山西省">山西省</option>
                        <option value="内蒙古自治区">内蒙古自治区</option>
                        <option value="辽宁省">辽宁省</option>
                        <option value="吉林省">吉林省</option>
                        <option value="黑龙江省">黑龙江省</option>
                        <option value="上海市">上海市</option>
                        <option value="江苏省">江苏省</option>
                        <option value="浙江省">浙江省</option>
                        <option value="安徽省">安徽省</option>
                        <option value="福建省">福建省</option>
                        <option value="江西省">江西省</option>
                        <option value="山东省">山东省</option>
                        <option value="河南省">河南省</option>
                        <option value="湖北省">湖北省</option>
                        <option value="湖南省">湖南省</option>
                        <option value="广东省">广东省</option>
                        <option value="广西壮族自治区">广西壮族自治区</option>
                        <option value="海南省">海南省</option>
                        <option value="重庆市">重庆市</option>
                        <option value="四川省">四川省</option>
                        <option value="贵州省">贵州省</option>
                        <option value="云南省">云南省</option>
                        <option value="西藏自治区">西藏自治区</option>
                        <option value="陕西省">陕西省</option>
                        <option value="甘肃省">甘肃省</option>
                        <option value="青海省">青海省</option>
                        <option value="宁夏回族自治区">宁夏回族自治区</option>
                        <option value="新疆维吾尔自治区">新疆维吾尔自治区</option>
                    </select>
                    <div class="error" id="hukouProvinceError">请选择户籍所在省份</div>
                </div>
                
                <div class="form-group">
                    <label for="currentProvince">当前参保省份</label>
                    <select id="currentProvince" name="currentProvince" required>
                        <option value="">-- 请选择省份 --</option>
                        <option value="北京市">北京市</option>
                        <option value="天津市">天津市</option>
                        <option value="河北省">河北省</option>
                        <option value="山西省">山西省</option>
                        <option value="内蒙古自治区">内蒙古自治区</option>
                        <option value="辽宁省">辽宁省</option>
                        <option value="吉林省">吉林省</option>
                        <option value="黑龙江省">黑龙江省</option>
                        <option value="上海市">上海市</option>
                        <option value="江苏省">江苏省</option>
                        <option value="浙江省">浙江省</option>
                        <option value="安徽省">安徽省</option>
                        <option value="福建省">福建省</option>
                        <option value="江西省">江西省</option>
                        <option value="山东省">山东省</option>
                        <option value="河南省">河南省</option>
                        <option value="湖北省">湖北省</option>
                        <option value="湖南省">湖南省</option>
                        <option value="广东省">广东省</option>
                        <option value="广西壮族自治区">广西壮族自治区</option>
                        <option value="海南省">海南省</option>
                        <option value="重庆市">重庆市</option>
                        <option value="四川省">四川省</option>
                        <option value="贵州省">贵州省</option>
                        <option value="云南省">云南省</option>
                        <option value="西藏自治区">西藏自治区</option>
                        <option value="陕西省">陕西省</option>
                        <option value="甘肃省">甘肃省</option>
                        <option value="青海省">青海省</option>
                        <option value="宁夏回族自治区">宁夏回族自治区</option>
                        <option value="新疆维吾尔自治区">新疆维吾尔自治区</option>
                    </select>
                    <div class="error" id="currentProvinceError">请选择当前参保省份</div>
                </div>
                
                <button type="button" id="nextToStep2" class="btn-next">下一步</button>
            </form>
        </div>
        
        <!-- 第二步：参保信息采集 -->
        <div class="step" id="step2">
            <div id="normalProvinceSection">
                <h2 class="section-title">参保记录</h2>
                <p>请按时间顺序添加您的参保记录，系统将根据累计缴费年限确定待遇领取地。</p>
                
                <div id="insuredRecords">
                    <!-- 参保记录将动态添加到这里 -->
                </div>
                
                <button type="button" id="addRecord" class="btn-add">+ 添加参保记录</button>
            </div>
            
            <div class="button-group">
                <button type="button" id="backToStep1" class="btn-back">上一步</button>
                <button type="button" id="nextToStep3" class="btn-next">下一步</button>
            </div>
        </div>
        
        <!-- 第三步：测算结果 -->
        <div class="step" id="step3">
            <div class="result" id="result">
                <h2>测算结果</h2>
                <div id="resultContent">
                    <!-- 结果将动态生成在这里 -->
                </div>
            </div>
            
            <div class="button-group">
                <button type="button" id="backToStep2FromResult" class="btn-back">上一步</button>
                <button type="button" id="restartCalc" class="btn-next">重新测算</button>
            </div>
        </div>
    </div>
    
    <!-- 广东省信息采集模态框 -->
    <div class="modal" id="guangdongModal">
        <div class="modal-content">
            <h2>广东省内参保信息采集</h2>
            <p>请补充您在广东省内的参保记录，以确定具体领取城市。</p>
            
            <div id="guangdongRecords">
                <!-- 广东省内参保记录将动态添加到这里 -->
            </div>
            
            <button type="button" id="addGuangdongRecord" class="btn-add">+ 添加广东省内参保记录</button>
            
            <div class="button-group">
                <button type="button" id="closeGuangdongModal" class="btn-back">取消</button>
                <button type="button" id="submitGuangdongInfo" class="btn-next">确定</button>
            </div>
        </div>
    </div>
    
    <!-- 早期结果模态框 -->
    <div class="modal" id="earlyResultModal">
        <div class="modal-content">
            <h2>测算结果</h2>
            
            <div class="early-result">
                <div class="early-warning">
                    您距离退休年龄超过半年时间，目前无法测算您的养老金领取地，请接近退休年龄时再进行测算。
                </div>
                <div id="earlyResultContent">
                    <!-- 早期结果将动态生成在这里 -->
                </div>
            </div>
            
            <button type="button" id="closeEarlyResultModal" class="btn-next" style="margin-top: 20px;">确定</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 步骤元素
            const step1 = document.getElementById('step1');
            const step2 = document.getElementById('step2');
            const step3 = document.getElementById('step3');
            
            // 步骤指示器
            const step1Indicator = document.getElementById('step1-indicator');
            const step2Indicator = document.getElementById('step2-indicator');
            const step3Indicator = document.getElementById('step3-indicator');
            
            // 按钮
            const nextToStep2Btn = document.getElementById('nextToStep2');
            const backToStep1Btn = document.getElementById('backToStep1');
            const nextToStep3Btn = document.getElementById('nextToStep3');
            const backToStep2FromResultBtn = document.getElementById('backToStep2FromResult');
            const restartCalcBtn = document.getElementById('restartCalc');
            
            // 表单元素
            const basicInfoForm = document.getElementById('basicInfoForm');
            const hukouProvince = document.getElementById('hukouProvince');
            const currentProvince = document.getElementById('currentProvince');
            const genderRadios = document.querySelectorAll('input[name="gender"]');
            const jobTypeGroup = document.getElementById('jobTypeGroup');
            const jobTypeRadios = document.querySelectorAll('input[name="jobType"]');
            
            // 参保记录区域
            const insuredRecords = document.getElementById('insuredRecords');
            const addRecordBtn = document.getElementById('addRecord');
            
            // 模态框
            const guangdongModal = document.getElementById('guangdongModal');
            const guangdongRecords = document.getElementById('guangdongRecords');
            const addGuangdongRecordBtn = document.getElementById('addGuangdongRecord');
            const closeGuangdongModalBtn = document.getElementById('closeGuangdongModal');
            const submitGuangdongInfoBtn = document.getElementById('submitGuangdongInfo');
            
            const earlyResultModal = document.getElementById('earlyResultModal');
            const earlyResultContent = document.getElementById('earlyResultContent');
            const closeEarlyResultModalBtn = document.getElementById('closeEarlyResultModal');
            
            // 结果区域
            const result = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');
            
            // 全局变量
            let recordCount = 0;
            let guangdongRecordCount = 0;
            let selectedProvinces = new Set();
            let userData = {};
            let retirementInfo = {};
            let pensionResult = {};
            let isGuangdongModalOpen = false;
            
            // 性别选择变化监听
            genderRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'female') {
                        jobTypeGroup.style.display = 'block';
                    } else {
                        jobTypeGroup.style.display = 'none';
                    }
                });
            });
            
            // 下一步到第二步
            nextToStep2Btn.addEventListener('click', function() {
                if (!validateBasicInfo()) {
                    return;
                }
                
                // 收集基本信息
                const formData = new FormData(basicInfoForm);
                userData = {
                    birthDate: formData.get('birthDate'),
                    gender: formData.get('gender'),
                    hukouProvince: formData.get('hukouProvince'),
                    currentProvince: formData.get('currentProvince')
                };
                
                // 如果是女性，收集岗位性质
                if (userData.gender === 'female') {
                    const jobType = document.querySelector('input[name="jobType"]:checked');
                    if (!jobType) {
                        alert('请选择岗位性质');
                        return;
                    }
                    userData.jobType = jobType.value;
                }
                
                // 计算退休信息
                retirementInfo = calculateRetirementInfo(userData);
                
                // 判断四种情况
                // 情况1：距离退休年龄超过6个月
                if (retirementInfo.monthsToRetirement > 6) {
                    showEarlyResult();
                    return;
                }
                
                // 情况2：距离退休年龄小于6个月且户籍地=参保地=广东省
                if (retirementInfo.monthsToRetirement <= 6 && 
                    userData.hukouProvince === '广东省' && 
                    userData.currentProvince === '广东省') {
                    showGuangdongModal();
                    return;
                }
                
                // 情况3：距离退休年龄小于6个月且户籍地=参保地≠广东省
                // 情况4：距离退休年龄小于6个月且户籍地≠参保地
                // 这两种情况都进入第二步
                // 自动添加一条当前参保省记录
                addRecordWithProvince(userData.currentProvince);
                
                // 切换到第二步
                switchStep(1, 2);
            });
            
            // 上一步到第一步
            backToStep1Btn.addEventListener('click', function() {
                switchStep(2, 1);
            });
            
            // 从结果页面上一步到第二步
            backToStep2FromResultBtn.addEventListener('click', function() {
                switchStep(3, 2);
            });
            
            // 重新测算
            restartCalcBtn.addEventListener('click', function() {
                // 清空表单
                basicInfoForm.reset();
                insuredRecords.innerHTML = '';
                recordCount = 0;
                selectedProvinces.clear();
                userData = {};
                isGuangdongModalOpen = false;
                
                // 切换到第一步
                switchStep(3, 1);
            });
            
            // 添加参保记录
            addRecordBtn.addEventListener('click', function() {
                addRecord();
            });
            
            // 添加广东省内参保记录
            addGuangdongRecordBtn.addEventListener('click', function() {
                addGuangdongRecord();
            });
            
            // 关闭广东省模态框
            closeGuangdongModalBtn.addEventListener('click', function() {
                guangdongModal.style.display = 'none';
                isGuangdongModalOpen = false;
            });
            
            // 提交广东省信息
            submitGuangdongInfoBtn.addEventListener('click', function() {
                if (!validateGuangdongRecords()) {
                    return;
                }
                
                // 收集广东省内参保记录
                userData.guangdongRecords = collectGuangdongRecords();
                
                // 关闭模态框
                guangdongModal.style.display = 'none';
                isGuangdongModalOpen = false;
                
                // 计算养老金领取地
                pensionResult = calculatePensionLocation(userData);
                
                // 显示结果
                displayResult(pensionResult);
                
                // 切换到第三步
                switchStep(1, 3);
            });
            
            // 关闭早期结果模态框
            closeEarlyResultModalBtn.addEventListener('click', function() {
                earlyResultModal.style.display = 'none';
            });
            
            // 下一步到第三步
            nextToStep3Btn.addEventListener('click', function() {
                if (!validateStep2()) {
                    return;
                }
                
                // 收集参保记录
                userData.insuredRecords = collectNormalRecords();
                
                // 计算养老金领取地
                pensionResult = calculatePensionLocation(userData);
                
                // 如果待遇领取地为广东省，则弹出广东省信息采集
                if (pensionResult.treatmentLocation === '广东省' && !userData.guangdongRecords && !isGuangdongModalOpen) {
                    showGuangdongModal();
                    isGuangdongModalOpen = true;
                    return;
                }
                
                // 显示结果
                displayResult(pensionResult);
                
                // 切换到第三步
                switchStep(2, 3);
            });
            
            // 切换步骤
            function switchStep(from, to) {
                // 隐藏当前步骤
                document.getElementById(`step${from}`).classList.remove('active');
                document.getElementById(`step${from}-indicator`).classList.remove('active');
                
                // 显示目标步骤
                document.getElementById(`step${to}`).classList.add('active');
                document.getElementById(`step${to}-indicator`).classList.add('active');
                
                // 标记已完成步骤
                if (to > from) {
                    for (let i = 1; i < to; i++) {
                        document.getElementById(`step${i}-indicator`).classList.add('completed');
                    }
                } else {
                    for (let i = to + 1; i <= 3; i++) {
                        document.getElementById(`step${i}-indicator`).classList.remove('completed');
                    }
                }
            }
            
            // 验证基本信息
            function validateBasicInfo() {
                let isValid = true;
                
                // 验证出生日期
                const birthDate = document.getElementById('birthDate');
                const birthDateError = document.getElementById('birthDateError');
                if (!birthDate.value) {
                    birthDateError.style.display = 'block';
                    isValid = false;
                } else {
                    birthDateError.style.display = 'none';
                }
                
                // 验证性别
                const gender = document.querySelector('input[name="gender"]:checked');
                if (!gender) {
                    alert('请选择性别');
                    isValid = false;
                }
                
                // 验证户籍地
                const hukouProvinceError = document.getElementById('hukouProvinceError');
                if (!hukouProvince.value) {
                    hukouProvinceError.style.display = 'block';
                    isValid = false;
                } else {
                    hukouProvinceError.style.display = 'none';
                }
                
                // 验证当前参保省份
                const currentProvinceError = document.getElementById('currentProvinceError');
                if (!currentProvince.value) {
                    currentProvinceError.style.display = 'block';
                    isValid = false;
                } else {
                    currentProvinceError.style.display = 'none';
                }
                
                return isValid;
            }
            
            // 验证第二步
            function validateStep2() {
                if (recordCount === 0) {
                    alert('请至少添加一条参保记录');
                    return false;
                }
                
                return true;
            }
            
            // 验证广东省记录
            function validateGuangdongRecords() {
                if (guangdongRecordCount === 0) {
                    alert('请至少添加一条广东省内参保记录');
                    return false;
                }
                
                return true;
            }
            
            // 添加参保记录
            function addRecord(province = '') {
                recordCount++;
                const recordDiv = document.createElement('div');
                recordDiv.className = 'insured-record';
                recordDiv.innerHTML = `
                    <h3>参保记录 ${recordCount}</h3>
                    <div class="row">
                        <div class="col">
                            <label>参保省份</label>
                            <select name="insuredProvince" required>
                                <option value="">-- 请选择省份 --</option>
                                <option value="北京市">北京市</option>
                                <option value="天津市">天津市</option>
                                <option value="河北省">河北省</option>
                                <option value="山西省">山西省</option>
                                <option value="内蒙古自治区">内蒙古自治区</option>
                                <option value="辽宁省">辽宁省</option>
                                <option value="吉林省">吉林省</option>
                                <option value="黑龙江省">黑龙江省</option>
                                <option value="上海市">上海市</option>
                                <option value="江苏省">江苏省</option>
                                <option value="浙江省">浙江省</option>
                                <option value="安徽省">安徽省</option>
                                <option value="福建省">福建省</option>
                                <option value="江西省">江西省</option>
                                <option value="山东省">山东省</option>
                                <option value="河南省">河南省</option>
                                <option value="湖北省">湖北省</option>
                                <option value="湖南省">湖南省</option>
                                <option value="广东省">广东省</option>
                                <option value="广西壮族自治区">广西壮族自治区</option>
                                <option value="海南省">海南省</option>
                                <option value="重庆市">重庆市</option>
                                <option value="四川省">四川省</option>
                                <option value="贵州省">贵州省</option>
                                <option value="云南省">云南省</option>
                                <option value="西藏自治区">西藏自治区</option>
                                <option value="陕西省">陕西省</option>
                                <option value="甘肃省">甘肃省</option>
                                <option value="青海省">青海省</option>
                                <option value="宁夏回族自治区">宁夏回族自治区</option>
                                <option value="新疆维吾尔自治区">新疆维吾尔自治区</option>
                            </select>
                            <div class="error">请选择参保省份</div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label>首次参保日期</label>
                            <input type="date" name="insuredDate" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label>累计缴费年限</label>
                            <div class="years-months-input">
                                <input type="number" name="insuredYears" min="0" max="50" placeholder="年" required>
                                <input type="number" name="insuredMonths" min="0" max="11" placeholder="月" required>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn-remove">删除此记录</button>
                `;
                
                insuredRecords.appendChild(recordDiv);
                
                // 设置默认省份
                if (province) {
                    const provinceSelect = recordDiv.querySelector('select[name="insuredProvince"]');
                    provinceSelect.value = province;
                    selectedProvinces.add(province);
                }
                
                // 添加删除按钮事件
                const removeBtn = recordDiv.querySelector('.btn-remove');
                removeBtn.addEventListener('click', function() {
                    const provinceSelect = recordDiv.querySelector('select[name="insuredProvince"]');
                    if (provinceSelect.value) {
                        selectedProvinces.delete(provinceSelect.value);
                    }
                    insuredRecords.removeChild(recordDiv);
                    recordCount--;
                });
                
                // 添加省份选择校验
                const provinceSelect = recordDiv.querySelector('select[name="insuredProvince"]');
                const errorDiv = recordDiv.querySelector('.error');
                
                provinceSelect.addEventListener('change', function() {
                    if (selectedProvinces.has(this.value)) {
                        errorDiv.textContent = '该省份已存在，请选择其他省份';
                        errorDiv.style.display = 'block';
                        this.setCustomValidity('该省份已存在');
                    } else {
                        // 移除之前选择的省份
                        if (this.oldValue) {
                            selectedProvinces.delete(this.oldValue);
                        }
                        
                        selectedProvinces.add(this.value);
                        this.oldValue = this.value;
                        errorDiv.style.display = 'none';
                        this.setCustomValidity('');
                    }
                });
            }
            
            // 添加带有默认省份的参保记录
            function addRecordWithProvince(province) {
                addRecord(province);
            }
            
            // 添加广东省内参保记录
            function addGuangdongRecord() {
                guangdongRecordCount++;
                const recordDiv = document.createElement('div');
                recordDiv.className = 'insured-record';
                recordDiv.innerHTML = `
                    <h3>广东省内参保记录 ${guangdongRecordCount}</h3>
                    <div class="row">
                        <div class="col">
                            <label>参保城市</label>
                            <select name="guangdongCity" required>
                                <option value="">-- 请选择城市 --</option>
                                <option value="广州市">广州市</option>
                                <option value="深圳市">深圳市</option>
                                <option value="珠海市">珠海市</option>
                                <option value="汕头市">汕头市</option>
                                <option value="佛山市">佛山市</option>
                                <option value="韶关市">韶关市</option>
                                <option value="湛江市">湛江市</option>
                                <option value="肇庆市">肇庆市</option>
                                <option value="江门市">江门市</option>
                                <option value="茂名市">茂名市</option>
                                <option value="惠州市">惠州市</option>
                                <option value="梅州市">梅州市</option>
                                <option value="汕尾市">汕尾市</option>
                                <option value="河源市">河源市</option>
                                <option value="阳江市">阳江市</option>
                                <option value="清远市">清远市</option>
                                <option value="东莞市">东莞市</option>
                                <option value="中山市">中山市</option>
                                <option value="潮州市">潮州市</option>
                                <option value="揭阳市">揭阳市</option>
                                <option value="云浮市">云浮市</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label>首次参保日期</label>
                            <input type="date" name="guangdongFirstDate" required>
                        </div>
                        <div class="col">
                            <label>最后参保日期</label>
                            <input type="date" name="guangdongLastDate" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label>累计缴费年限</label>
                            <div class="years-months-input">
                                <input type="number" name="guangdongYears" min="0" max="50" placeholder="年" required>
                                <input type="number" name="guangdongMonths" min="0" max="11" placeholder="月" required>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn-remove">删除此记录</button>
                `;
                
                guangdongRecords.appendChild(recordDiv);
                
                // 添加删除按钮事件
                const removeBtn = recordDiv.querySelector('.btn-remove');
                removeBtn.addEventListener('click', function() {
                    guangdongRecords.removeChild(recordDiv);
                    guangdongRecordCount--;
                });
            }
            
            // 收集普通参保记录
            function collectNormalRecords() {
                const records = [];
                const recordElements = document.querySelectorAll('#insuredRecords .insured-record');
                
                recordElements.forEach(record => {
                    const province = record.querySelector('select[name="insuredProvince"]').value;
                    const date = record.querySelector('input[name="insuredDate"]').value;
                    const years = parseInt(record.querySelector('input[name="insuredYears"]').value) || 0;
                    const months = parseInt(record.querySelector('input[name="insuredMonths"]').value) || 0;
                    
                    records.push({
                        province: province,
                        date: date,
                        years: years,
                        months: months
                    });
                });
                
                return records;
            }
            
            // 收集广东省内参保记录
            function collectGuangdongRecords() {
                const records = [];
                const recordElements = document.querySelectorAll('#guangdongRecords .insured-record');
                
                recordElements.forEach(record => {
                    const city = record.querySelector('select[name="guangdongCity"]').value;
                    const firstDate = record.querySelector('input[name="guangdongFirstDate"]').value;
                    const lastDate = record.querySelector('input[name="guangdongLastDate"]').value;
                    const years = parseInt(record.querySelector('input[name="guangdongYears"]').value) || 0;
                    const months = parseInt(record.querySelector('input[name="guangdongMonths"]').value) || 0;
                    
                    records.push({
                        city: city,
                        firstDate: firstDate,
                        lastDate: lastDate,
                        years: years,
                        months: months
                    });
                });
                
                return records;
            }
     
    // 计算退休信息
    function calculateRetirementInfo(data) {
        const birthDate = new Date(data.birthDate);
        const birthYear = birthDate.getFullYear();
        const birthMonth = birthDate.getMonth() + 1; // 月份从0开始，需要+1
        
        let originalRetirementAge = 0;
        let delayMonths = 0;
        let retirementAge = 0;
        let retirementYear = 0;
        let retirementMonth = 0;
        
        // 判断退休年龄和延迟规则
        if (data.gender === 'male') {
            // 男性，原法定退休年龄60周岁
            originalRetirementAge = 60;
            
            // 计算延迟退休时间
            if (birthYear <= 1965) {
                // 1965年及以前出生，不延迟
                delayMonths = 0;
            } else if (birthYear >= 1977) {
                // 1977年及以后出生，延迟到63岁退休
                delayMonths = 36; // 3年=36个月
            } else {
                // 1966年至1976年出生，每4个月延迟1个月
                const startYear = 1965;
                const delayPerPeriod = 1; // 每期延迟月数
                const monthsPerPeriod = 4; // 每期间隔月数
                
                // 计算出生月份在延迟周期中的位置
                const totalMonthsFromStart = (birthYear - startYear) * 12 + (birthMonth - 1);
                // 修正：周期数需要+1
                const periods = Math.floor(totalMonthsFromStart / monthsPerPeriod) + 1;
                delayMonths = periods * delayPerPeriod;
                
                // 最大延迟36个月
                if (delayMonths > 36) {
                    delayMonths = 36;
                }
            }
        } else {
            // 女性
            if (data.jobType === 'management') {
                // 管理岗/技术岗/灵活就业人员，原法定退休年龄55周岁
                originalRetirementAge = 55;
                
                // 计算延迟退休时间
                if (birthYear <= 1970) {
                    // 1970年及以前出生，不延迟
                    delayMonths = 0;
                } else if (birthYear >= 1982) {
                    // 1982年及以后出生，延迟到58岁退休
                    delayMonths = 36; // 3年=36个月
                } else {
                    // 1971年至1981年出生，每4个月延迟1个月
                    const startYear = 1970;
                    const delayPerPeriod = 1; // 每期延迟月数
                    const monthsPerPeriod = 4; // 每期间隔月数
                    
                    // 计算出生月份在延迟周期中的位置
                    const totalMonthsFromStart = (birthYear - startYear) * 12 + (birthMonth - 1);
                    // 修正：周期数需要+1
                    const periods = Math.floor(totalMonthsFromStart / monthsPerPeriod) + 1;
                    delayMonths = periods * delayPerPeriod;
                    
                    // 最大延迟36个月
                    if (delayMonths > 36) {
                        delayMonths = 36;
                    }
                }
            } else {
                // 非管理技术岗，原法定退休年龄50周岁
                originalRetirementAge = 50;
                
                // 计算延迟退休时间
                if (birthYear <= 1975) {
                    // 1975年及以前出生，不延迟
                    delayMonths = 0;
                } else if (birthYear >= 1985) {
                    // 1985年及以后出生，延迟到55岁退休
                    delayMonths = 60; // 5年=60个月
                } else {
                    // 1976年至1984年出生，每2个月延迟1个月
                    const startYear = 1975;
                    const delayPerPeriod = 1; // 每期延迟月数
                    const monthsPerPeriod = 2; // 每期间隔月数
                    
                    // 计算出生月份在延迟周期中的位置
                    const totalMonthsFromStart = (birthYear - startYear) * 12 + (birthMonth - 1);
                    // 修正：周期数需要+1
                    const periods = Math.floor(totalMonthsFromStart / monthsPerPeriod) + 1;
                    delayMonths = periods * delayPerPeriod;
                    
                    // 最大延迟60个月
                    if (delayMonths > 60) {
                        delayMonths = 60;
                    }
                }
            }
        }
        
        // 计算实际退休年龄（年+月格式）
        const retirementAgeYears = originalRetirementAge + Math.floor(delayMonths / 12);
        const retirementAgeMonths = delayMonths % 12;
        
        // 计算退休年份和月份
        retirementYear = birthYear + retirementAgeYears;
        retirementMonth = birthMonth + retirementAgeMonths;
        
        // 处理月份超过12的情况
        if (retirementMonth > 12) {
            retirementYear += Math.floor(retirementMonth / 12);
            retirementMonth = retirementMonth % 12;
        }
        
        // 计算最低缴费年限
        let minYears = 15;
        let minMonths = 0;
        
        if (retirementYear >= 2040) {
            minYears = 20;
        } else if (retirementYear >= 2030) {
            const extraYears = retirementYear - 2030;
            minYears = 15 + extraYears;
            minMonths = 0;
            
            // 2030年是15年6个月，之后每年增加6个月
            if (retirementYear === 2030) {
                minMonths = 6;
            }
        }
        
        // 计算距离退休还有多少个月
        const now = new Date();
        const currentYear = now.getFullYear();
        const currentMonth = now.getMonth() + 1;
        
        let monthsToRetirement = (retirementYear - currentYear) * 12 + (retirementMonth - currentMonth);
        if (monthsToRetirement < 0) {
            monthsToRetirement = 0;
        }
        
        return {
            originalRetirementAge: originalRetirementAge,
            delayMonths: delayMonths,
            retirementAge: retirementAgeYears + retirementAgeMonths / 12, // 保持小数格式用于计算
            retirementAgeYears: retirementAgeYears, // 新增：退休年龄-年
            retirementAgeMonths: retirementAgeMonths, // 新增：退休年龄-月
            retirementYear: retirementYear,
            retirementMonth: retirementMonth,
            minYears: minYears,
            minMonths: minMonths,
            monthsToRetirement: monthsToRetirement
        };
    }
    
    // 显示早期结果
    function showEarlyResult() {
        // 显示早期结果
        earlyResultContent.innerHTML = `
            <div class="result-item">
                <div class="section-title">退休年龄</div>
                <div>您的退休年龄：<span class="highlight">${retirementInfo.retirementAgeYears}岁${retirementInfo.retirementAgeMonths > 0 ? retirementInfo.retirementAgeMonths + '个月' : ''}</span></div>
                <div>预计退休年份：<span class="highlight">${retirementInfo.retirementYear}年${retirementInfo.retirementMonth}月</span></div>
            </div>
            <div class="result-item">
                <div class="section-title">最低缴费年限</div>
                <div>您的退休最低缴费年限要求：<span class="highlight">${retirementInfo.minYears}年${retirementInfo.minMonths > 0 ? retirementInfo.minMonths + '个月' : ''}</span></div>
            </div>
            <div class="result-item">
                  <div class="section-title">政策依据</div>
            <div class="policy-section">
                <h4>1.跨省待遇领取地确定</h4>
                <p>第六条　跨省流动就业的参保人员达到待遇领取条件时，按下列规定确定其待遇领取地：</p>
                <p>（一）基本养老保险关系在户籍所在地的，由户籍所在地负责办理待遇领取手续，享受基本养老保险待遇。</p>
                <p>（二）基本养老保险关系不在户籍所在地，而在其基本养老保险关系所在地累计缴费年限满10年的，在该地办理待遇领取手续，享受当地基本养老保险待遇。</p>
                <p>（三）基本养老保险关系不在户籍所在地，且在其基本养老保险关系所在地累计缴费年限不满10年的，将其基本养老保险关系转回上一个缴费年限满10年的原参保地办理待遇领取手续，享受基本养老保险待遇。</p>
                <p>（四）基本养老保险关系不在户籍所在地，且在每个参保地的累计缴费年限均不满10年的，将其基本养老保险关系及相应资金归集到户籍所在地，由户籍所在地按规定办理待遇领取手续，享受基本养老保险待遇。</p>
                <p>——《国务院办公厅关于转发人力资源社会保障部财政部城镇企业职工基本养老保险关系转移接续暂行办法的通知》国办发〔2009〕66号</p>
            </div>
            <div class="policy-section">
                <h4>2.临时账户规定</h4>
                <p>2010年1月1日起，男年满50周岁、女年满40周岁的劳动者在非户籍地首次参加城镇企业职工基本养老保险的(经县级以上党委组织部门、人力资源社会保障行政部门批准调动的除外),参保地应当为其建立临时基本养老保险缴费账户(以下简称临时账户)。</p>
                <p><span class="highlight">临时账户缴费年限不参与确定待遇领取地。</span></p>
            </div>
            <div class="policy-section">
                <h4>3.省内跨地市待遇领取地确定</h4>
                <p>参保人符合领取基本养老保险待遇的条件时，由最后参保地社会保险经办机构按规定办理申领、审核手续并发放基本养老保险金、年度调整增加的基本养老金和死亡待遇等。</p>
                <p>——《印发广东省基本养老保险关系省内转移接续暂行办法的通知》（粤府办〔2008〕76号）</p>
            </div>
        `;
        
        earlyResultModal.style.display = 'flex';
    }
    
    // 显示结果
    function displayResult(result) {
        resultContent.innerHTML = '';
        
        // 1. 养老金领取地
        const locationDiv = document.createElement('div');
        locationDiv.className = 'result-item final-result';
        locationDiv.innerHTML = `
            <div class="section-title">领取地结果</div>
            <div class="location-result">您的养老金领取地为：${result.treatmentLocation}${result.treatmentCity ? '（' + result.treatmentCity + '）' : ''}</div>
        `;
        resultContent.appendChild(locationDiv);
        
        // 2. 参保信息详情
        if (result.insuredDetails.length > 0) {
            const detailsDiv = document.createElement('div');
            detailsDiv.className = 'result-item';
            detailsDiv.innerHTML = '<div class="section-title">参保信息详情</div>';
            
            const table = document.createElement('table');
            table.className = 'info-table';
            
            // 表头
            const thead = document.createElement('thead');
            thead.innerHTML = `
                <tr>
                    <th>省份</th>
                    <th>累计缴费年限</th>
                    <th>备注</th>
                </tr>
            `;
            table.appendChild(thead);
            
            // 表体
            const tbody = document.createElement('tbody');
            result.insuredDetails.forEach(detail => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${detail.province}</td>
                    <td>${detail.years}年${detail.months}个月</td>
                    <td>${detail.remark}</td>
                `;
                tbody.appendChild(row);
            });
            table.appendChild(tbody);
            
            detailsDiv.appendChild(table);
            resultContent.appendChild(detailsDiv);
        }
        
        // 3. 退休年龄
        const retirementDiv = document.createElement('div');
        retirementDiv.className = 'result-item';
        retirementDiv.innerHTML = `
            <div class="section-title">退休年龄</div>
            <div>您的退休年龄：<span class="highlight">${retirementInfo.retirementAgeYears}岁${retirementInfo.retirementAgeMonths > 0 ? retirementInfo.retirementAgeMonths + '个月' : ''}</span></div>
            <div>预计退休年份：<span class="highlight">${retirementInfo.retirementYear}年${retirementInfo.retirementMonth}月</span></div>
        `;
        resultContent.appendChild(retirementDiv);
        
        // 4. 最低缴费年限
        const minYearsDiv = document.createElement('div');
        minYearsDiv.className = 'result-item';
        
        // 计算是否满足最低缴费年限
        const totalMonths = result.totalYears * 12 + result.totalMonths;
        const minMonths = retirementInfo.minYears * 12 + retirementInfo.minMonths;
        const isSatisfied = totalMonths >= minMonths;
        
        let yearsText = '';
        if (isSatisfied) {
            yearsText = `<span class="satisfy-requirement">您已满足最低缴费年限要求</span>，达到退休年龄前1个月到养老金领取地<span class="highlight">【${result.treatmentLocation}】</span>办理退休手续领养老金。`;
        } else {
            yearsText = `<span class="not-satisfy-requirement">您当前还不满足最低缴费年限要求</span>，在达到退休年龄前1个月到养老金领取地<span class="highlight">【${result.treatmentLocation}】</span>办理延长缴费，直至缴够<span class="highlight">【${retirementInfo.minYears}年${retirementInfo.minMonths > 0 ? retirementInfo.minMonths + '个月' : ''}】</span>后办理退休手续领养老金。`;
        }
        
        minYearsDiv.innerHTML = `
            <div class="section-title">最低缴费年限</div>
            <div>您的退休最低缴费年限要求：<span class="highlight">${retirementInfo.minYears}年${retirementInfo.minMonths > 0 ? retirementInfo.minMonths + '个月' : ''}</span></div>
            <div>您的累计缴费年限：<span class="highlight">${result.totalYears}年${result.totalMonths}个月</span></div>
            <div>${yearsText}</div>
        `;
        resultContent.appendChild(minYearsDiv);
        
        // 5. 政策依据
        const policyDiv = document.createElement('div');
        policyDiv.className = 'result-item';
        policyDiv.innerHTML = `
         <div class="section-title">政策依据</div>
            <div class="policy-section">
                <h4>1.跨省待遇领取地确定</h4>
                <p>第六条　跨省流动就业的参保人员达到待遇领取条件时，按下列规定确定其待遇领取地：</p>
                <p>（一）基本养老保险关系在户籍所在地的，由户籍所在地负责办理待遇领取手续，享受基本养老保险待遇。</p>
                <p>（二）基本养老保险关系不在户籍所在地，而在其基本养老保险关系所在地累计缴费年限满10年的，在该地办理待遇领取手续，享受当地基本养老保险待遇。</p>
                <p>（三）基本养老保险关系不在户籍所在地，且在其基本养老保险关系所在地累计缴费年限不满10年的，将其基本养老保险关系转回上一个缴费年限满10年的原参保地办理待遇领取手续，享受基本养老保险待遇。</p>
                <p>（四）基本养老保险关系不在户籍所在地，且在每个参保地的累计缴费年限均不满10年的，将其基本养老保险关系及相应资金归集到户籍所在地，由户籍所在地按规定办理待遇领取手续，享受基本养老保险待遇。</p>
                <p>——《国务院办公厅关于转发人力资源社会保障部财政部城镇企业职工基本养老保险关系转移接续暂行办法的通知》国办发〔2009〕66号</p>
            </div>
            <div class="policy-section">
                <h4>2.临时账户规定</h4>
                <p>2010年1月1日起，男年满50周岁、女年满40周岁的劳动者在非户籍地首次参加城镇企业职工基本养老保险的(经县级以上党委组织部门、人力资源社会保障行政部门批准调动的除外),参保地应当为其建立临时基本养老保险缴费账户(以下简称临时账户)。</p>
                <p><span class="highlight">$临时账户缴费年限不参与确定待遇领取地。</span></p>
            </div>
            <div class="policy-section">
                <h4>3.省内跨地市待遇领取地确定</h4>
                <p>参保人符合领取基本养老保险待遇的条件时，由最后参保地社会保险经办机构按规定办理申领、审核手续并发放基本养老保险金、年度调整增加的基本养老金和死亡待遇等。</p>
                <p>——《印发广东省基本养老保险关系省内转移接续暂行办法的通知》（粤府办〔2008〕76号）</p>
            </div>
        `;
        resultContent.appendChild(policyDiv);
    }
});
</script>